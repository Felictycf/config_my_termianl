"use strict";var ei=Object.create;var nt=Object.defineProperty;var ti=Object.getOwnPropertyDescriptor;var ni=Object.getOwnPropertyNames;var ri=Object.getPrototypeOf,ii=Object.prototype.hasOwnProperty;var oi=(c,u)=>()=>(u||c((u={exports:{}}).exports,u),u.exports),si=(c,u)=>{for(var p in u)nt(c,p,{get:u[p],enumerable:!0})},Fn=(c,u,p,m)=>{if(u&&typeof u=="object"||typeof u=="function")for(let y of ni(u))!ii.call(c,y)&&y!==p&&nt(c,y,{get:()=>u[y],enumerable:!(m=ti(u,y))||m.enumerable});return c};var Gn=(c,u,p)=>(p=c!=null?ei(ri(c)):{},Fn(u||!c||!c.__esModule?nt(p,"default",{value:c,enumerable:!0}):p,c)),ai=c=>Fn(nt({},"__esModule",{value:!0}),c);var Xn=oi((pt,be)=>{"use strict";var ct=void 0,ft=function(c){return ct||(ct=new Promise(function(u,p){var m=typeof c<"u"?c:{},y=m.onAbort;m.onAbort=function(e){p(new Error(e)),y&&y(e)},m.postRun=m.postRun||[],m.postRun.push(function(){u(m)}),be=void 0;var i;i||(i=typeof m<"u"?m:{}),i.onRuntimeInitialized=function(){function e(a,f){this.La=a,this.db=f,this.Ja=1,this.eb=[]}function t(a,f){if(this.db=f,f=_e(a)+1,this.Ya=Xe(f),this.Ya===null)throw Error("Unable to allocate memory for the SQL string");fe(a,$,this.Ya,f),this.cb=this.Ya,this.Ua=this.ib=null}function n(a){if(this.filename="dbfile_"+(4294967295*Math.random()>>>0),a!=null){var f=this.filename,g="/",b=f;if(g&&(g=typeof g=="string"?g:Be(g),b=f?Z(g+"/"+f):g),f=qn(!0,!0),b=$e(b,(f!==void 0?f:438)&4095|32768,0),a){if(typeof a=="string"){g=Array(a.length);for(var x=0,K=a.length;x<K;++x)g[x]=a.charCodeAt(x);a=g}Ke(b,f|146),g=de(b,577),En(g,a,0,a.length,0,void 0),Bt(g),Ke(b,f)}}this.handleError(s(this.filename,r)),this.db=X(r,"i32"),Xr(this.db),this.Za={},this.Ra={}}var r=ee(4),o=i.cwrap,s=o("sqlite3_open","number",["string","number"]),h=o("sqlite3_close_v2","number",["number"]),_=o("sqlite3_exec","number",["number","string","number","number","number"]),v=o("sqlite3_changes","number",["number"]),D=o("sqlite3_prepare_v2","number",["number","string","number","number","number"]),C=o("sqlite3_sql","string",["number"]),te=o("sqlite3_normalized_sql","string",["number"]),Ot=o("sqlite3_prepare_v2","number",["number","number","number","number","number"]),Ir=o("sqlite3_bind_text","number",["number","number","number","number","number"]),Mn=o("sqlite3_bind_blob","number",["number","number","number","number","number"]),Ar=o("sqlite3_bind_double","number",["number","number","number"]),qr=o("sqlite3_bind_int","number",["number","number","number"]),xr=o("sqlite3_bind_parameter_index","number",["number","string"]),Lr=o("sqlite3_step","number",["number"]),Br=o("sqlite3_errmsg","string",["number"]),Pr=o("sqlite3_column_count","number",["number"]),Rr=o("sqlite3_data_count","number",["number"]),Tr=o("sqlite3_column_double","number",["number","number"]),Cn=o("sqlite3_column_text","string",["number","number"]),Mr=o("sqlite3_column_blob","number",["number","number"]),Cr=o("sqlite3_column_bytes","number",["number","number"]),Or=o("sqlite3_column_type","number",["number","number"]),Nr=o("sqlite3_column_name","string",["number","number"]),Hr=o("sqlite3_reset","number",["number"]),Fr=o("sqlite3_clear_bindings","number",["number"]),Gr=o("sqlite3_finalize","number",["number"]),Ur=o("sqlite3_create_function_v2","number","number string number number number number number number number".split(" ")),jr=o("sqlite3_value_type","number",["number"]),$r=o("sqlite3_value_bytes","number",["number"]),zr=o("sqlite3_value_text","string",["number"]),Kr=o("sqlite3_value_blob","number",["number"]),Qr=o("sqlite3_value_double","number",["number"]),Wr=o("sqlite3_result_double","",["number","number"]),On=o("sqlite3_result_null","",["number"]),Vr=o("sqlite3_result_text","",["number","string","number","number"]),Jr=o("sqlite3_result_blob","",["number","number","number","number"]),Yr=o("sqlite3_result_int","",["number","number"]),Nn=o("sqlite3_result_error","",["number","string","number"]),Xr=o("RegisterExtensionFunctions","number",["number"]);e.prototype.bind=function(a){if(!this.La)throw"Statement closed";return this.reset(),Array.isArray(a)?this.xb(a):a!=null&&typeof a=="object"?this.yb(a):!0},e.prototype.step=function(){if(!this.La)throw"Statement closed";this.Ja=1;var a=Lr(this.La);switch(a){case 100:return!0;case 101:return!1;default:throw this.db.handleError(a)}},e.prototype.sb=function(a){return a==null&&(a=this.Ja,this.Ja+=1),Tr(this.La,a)},e.prototype.Cb=function(a){if(a==null&&(a=this.Ja,this.Ja+=1),a=Cn(this.La,a),typeof BigInt!="function")throw Error("BigInt is not supported");return BigInt(a)},e.prototype.Db=function(a){return a==null&&(a=this.Ja,this.Ja+=1),Cn(this.La,a)},e.prototype.getBlob=function(a){a==null&&(a=this.Ja,this.Ja+=1);var f=Cr(this.La,a);a=Mr(this.La,a);for(var g=new Uint8Array(f),b=0;b<f;b+=1)g[b]=P[a+b];return g},e.prototype.get=function(a,f){f=f||{},a!=null&&this.bind(a)&&this.step(),a=[];for(var g=Rr(this.La),b=0;b<g;b+=1)switch(Or(this.La,b)){case 1:var x=f.useBigInt?this.Cb(b):this.sb(b);a.push(x);break;case 2:a.push(this.sb(b));break;case 3:a.push(this.Db(b));break;case 4:a.push(this.getBlob(b));break;default:a.push(null)}return a},e.prototype.getColumnNames=function(){for(var a=[],f=Pr(this.La),g=0;g<f;g+=1)a.push(Nr(this.La,g));return a},e.prototype.getAsObject=function(a,f){a=this.get(a,f),f=this.getColumnNames();for(var g={},b=0;b<f.length;b+=1)g[f[b]]=a[b];return g},e.prototype.getSQL=function(){return C(this.La)},e.prototype.getNormalizedSQL=function(){return te(this.La)},e.prototype.run=function(a){return a!=null&&this.bind(a),this.step(),this.reset()},e.prototype.nb=function(a,f){f==null&&(f=this.Ja,this.Ja+=1),a=Pn(a);var g=wt(a);this.eb.push(g),this.db.handleError(Ir(this.La,f,g,a.length-1,0))},e.prototype.wb=function(a,f){f==null&&(f=this.Ja,this.Ja+=1);var g=wt(a);this.eb.push(g),this.db.handleError(Mn(this.La,f,g,a.length,0))},e.prototype.mb=function(a,f){f==null&&(f=this.Ja,this.Ja+=1),this.db.handleError((a===(a|0)?qr:Ar)(this.La,f,a))},e.prototype.zb=function(a){a==null&&(a=this.Ja,this.Ja+=1),Mn(this.La,a,0,0,0)},e.prototype.ob=function(a,f){switch(f==null&&(f=this.Ja,this.Ja+=1),typeof a){case"string":this.nb(a,f);return;case"number":this.mb(a,f);return;case"bigint":this.nb(a.toString(),f);return;case"boolean":this.mb(a+0,f);return;case"object":if(a===null){this.zb(f);return}if(a.length!=null){this.wb(a,f);return}}throw"Wrong API use : tried to bind a value of an unknown type ("+a+")."},e.prototype.yb=function(a){var f=this;return Object.keys(a).forEach(function(g){var b=xr(f.La,g);b!==0&&f.ob(a[g],b)}),!0},e.prototype.xb=function(a){for(var f=0;f<a.length;f+=1)this.ob(a[f],f+1);return!0},e.prototype.reset=function(){return this.freemem(),Fr(this.La)===0&&Hr(this.La)===0},e.prototype.freemem=function(){for(var a;(a=this.eb.pop())!==void 0;)Ze(a)},e.prototype.free=function(){this.freemem();var a=Gr(this.La)===0;return delete this.db.Za[this.La],this.La=0,a},t.prototype.next=function(){if(this.Ya===null)return{done:!0};if(this.Ua!==null&&(this.Ua.free(),this.Ua=null),!this.db.db)throw this.gb(),Error("Database closed");var a=Te(),f=ee(4);xe(r),xe(f);try{this.db.handleError(Ot(this.db.db,this.cb,-1,r,f)),this.cb=X(f,"i32");var g=X(r,"i32");return g===0?(this.gb(),{done:!0}):(this.Ua=new e(g,this.db),this.db.Za[g]=this.Ua,{value:this.Ua,done:!1})}catch(b){throw this.ib=M(this.cb),this.gb(),b}finally{Me(a)}},t.prototype.gb=function(){Ze(this.Ya),this.Ya=null},t.prototype.getRemainingSQL=function(){return this.ib!==null?this.ib:M(this.cb)},typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"&&(t.prototype[Symbol.iterator]=function(){return this}),n.prototype.run=function(a,f){if(!this.db)throw"Database closed";if(f){a=this.prepare(a,f);try{a.step()}finally{a.free()}}else this.handleError(_(this.db,a,0,0,r));return this},n.prototype.exec=function(a,f,g){if(!this.db)throw"Database closed";var b=Te(),x=null;try{var K=_e(a)+1,H=ee(K);fe(a,P,H,K);var De=H,ye=ee(4);for(a=[];X(De,"i8")!==0;){xe(r),xe(ye),this.handleError(Ot(this.db,De,-1,r,ye));var O=X(r,"i32");if(De=X(ye,"i32"),O!==0){for(K=null,x=new e(O,this),f!=null&&x.bind(f);x.step();)K===null&&(K={columns:x.getColumnNames(),values:[]},a.push(K)),K.values.push(x.get(null,g));x.free()}}return a}catch(Q){throw x&&x.free(),Q}finally{Me(b)}},n.prototype.each=function(a,f,g,b,x){typeof f=="function"&&(b=g,g=f,f=void 0),a=this.prepare(a,f);try{for(;a.step();)g(a.getAsObject(null,x))}finally{a.free()}if(typeof b=="function")return b()},n.prototype.prepare=function(a,f){if(xe(r),this.handleError(D(this.db,a,-1,r,0)),a=X(r,"i32"),a===0)throw"Nothing to prepare";var g=new e(a,this);return f!=null&&g.bind(f),this.Za[a]=g},n.prototype.iterateStatements=function(a){return new t(a,this)},n.prototype.export=function(){Object.values(this.Za).forEach(function(f){f.free()}),Object.values(this.Ra).forEach(gt),this.Ra={},this.handleError(h(this.db));var a=kr(this.filename);return this.handleError(s(this.filename,r)),this.db=X(r,"i32"),a},n.prototype.close=function(){this.db!==null&&(Object.values(this.Za).forEach(function(a){a.free()}),Object.values(this.Ra).forEach(gt),this.Ra={},this.handleError(h(this.db)),wn("/"+this.filename),this.db=null)},n.prototype.handleError=function(a){if(a===0)return null;throw a=Br(this.db),Error(a)},n.prototype.getRowsModified=function(){return v(this.db)},n.prototype.create_function=function(a,f){Object.prototype.hasOwnProperty.call(this.Ra,a)&&(gt(this.Ra[a]),delete this.Ra[a]);var g=ar(function(b,x,K){for(var H,De=[],ye=0;ye<x;ye+=1){var O=X(K+4*ye,"i32"),Q=jr(O);if(Q===1||Q===2)O=Qr(O);else if(Q===3)O=zr(O);else if(Q===4){Q=O,O=$r(Q),Q=Kr(Q);for(var Hn=new Uint8Array(O),tt=0;tt<O;tt+=1)Hn[tt]=P[Q+tt];O=Hn}else O=null;De.push(O)}try{H=f.apply(null,De)}catch(Zr){Nn(b,Zr,-1);return}switch(typeof H){case"boolean":Yr(b,H?1:0);break;case"number":Wr(b,H);break;case"string":Vr(b,H,-1,-1);break;case"object":H===null?On(b):H.length!=null?(x=wt(H),Jr(b,x,H.length,-1),Ze(x)):Nn(b,"Wrong API use : tried to return a value of an unknown type ("+H+").",-1);break;default:On(b)}});return this.Ra[a]=g,this.handleError(Ur(this.db,a,f.length,1,0,g,0,0,0)),this},i.Database=n};var k=Object.assign({},i),S="./this.program",L=typeof window=="object",E=typeof importScripts=="function",q=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",B="",Y,ie,G,oe,He,dt;q?(B=E?require("path").dirname(B)+"/":__dirname+"/",dt=()=>{He||(oe=require("fs"),He=require("path"))},Y=function(e,t){return dt(),e=He.normalize(e),oe.readFileSync(e,t?void 0:"utf8")},G=e=>(e=Y(e,!0),e.buffer||(e=new Uint8Array(e)),e),ie=(e,t,n)=>{dt(),e=He.normalize(e),oe.readFile(e,function(r,o){r?n(r):t(o.buffer)})},1<process.argv.length&&(S=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),typeof be<"u"&&(be.exports=i),i.inspect=function(){return"[Emscripten Module object]"}):(L||E)&&(E?B=self.location.href:typeof document<"u"&&document.currentScript&&(B=document.currentScript.src),B=B.indexOf("blob:")!==0?B.substr(0,B.replace(/[?#].*/,"").lastIndexOf("/")+1):"",Y=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},E&&(G=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),ie=(e,t,n)=>{var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=()=>{r.status==200||r.status==0&&r.response?t(r.response):n()},r.onerror=n,r.send(null)});var Jt=i.print||console.log.bind(console),le=i.printErr||console.warn.bind(console);Object.assign(i,k),k=null,i.thisProgram&&(S=i.thisProgram);var yt=[],ce;function ar(e){if(!ce){ce=new WeakMap;for(var t=pe.length,n=0;n<0+t;n++){var r=Ge(n);r&&ce.set(r,n)}}if(ce.has(e))return ce.get(e);if(yt.length)t=yt.pop();else{try{pe.grow(1)}catch(s){throw s instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":s}t=pe.length-1}try{n=t,pe.set(n,e),ve[n]=e}catch(s){if(!(s instanceof TypeError))throw s;if(typeof WebAssembly.Function=="function"){r={i:"i32",j:"i64",f:"f32",d:"f64"};var o={parameters:[],results:[]};for(n=1;4>n;++n)o.parameters.push(r["viii"[n]]);r=new WebAssembly.Function(o,e)}else{for(r=[1,0,1,96],o={i:127,j:126,f:125,d:124},r.push(3),n=0;3>n;++n)r.push(o["iii"[n]]);r.push(0),r[1]=r.length-2,n=new Uint8Array([0,97,115,109,1,0,0,0].concat(r,[2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0])),n=new WebAssembly.Module(n),r=new WebAssembly.Instance(n,{e:{f:e}}).exports.f}n=t,pe.set(n,r),ve[n]=r}return ce.set(e,t),t}function gt(e){ce.delete(Ge(e)),yt.push(e)}var qe;i.wasmBinary&&(qe=i.wasmBinary);var Si=i.noExitRuntime||!0;typeof WebAssembly!="object"&&se("no native wasm support detected");function xe(e){var t="i32";switch(t.charAt(t.length-1)==="*"&&(t="i32"),t){case"i1":P[e>>0]=0;break;case"i8":P[e>>0]=0;break;case"i16":Fe[e>>1]=0;break;case"i32":d[e>>2]=0;break;case"i64":j=[0,(A=0,1<=+Math.abs(A)?0<A?(Math.min(+Math.floor(A/4294967296),4294967295)|0)>>>0:~~+Math.ceil((A-+(~~A>>>0))/4294967296)>>>0:0)],d[e>>2]=j[0],d[e+4>>2]=j[1];break;case"float":vt[e>>2]=0;break;case"double":St[e>>3]=0;break;default:se("invalid type for setValue: "+t)}}function X(e,t="i8"){switch(t.charAt(t.length-1)==="*"&&(t="i32"),t){case"i1":return P[e>>0];case"i8":return P[e>>0];case"i16":return Fe[e>>1];case"i32":return d[e>>2];case"i64":return d[e>>2];case"float":return vt[e>>2];case"double":return Number(St[e>>3]);default:se("invalid type for getValue: "+t)}return null}var bt,Yt=!1;function ur(e,t,n,r){var o={string:function(D){var C=0;if(D!=null&&D!==0){var te=(D.length<<2)+1;C=ee(te),fe(D,$,C,te)}return C},array:function(D){var C=ee(D.length);return P.set(D,C),C}};e=i["_"+e];var s=[],h=0;if(r)for(var _=0;_<r.length;_++){var v=o[n[_]];v?(h===0&&(h=Te()),s[_]=v(r[_])):s[_]=r[_]}return n=e.apply(null,s),n=function(D){return h!==0&&Me(h),t==="string"?M(D):t==="boolean"?!!D:D}(n)}var lr=0,cr=1;function wt(e){var t=lr==cr?ee(e.length):Xe(e.length);return e.subarray||e.slice||(e=new Uint8Array(e)),$.set(e,t),t}var Xt=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function we(e,t,n){var r=t+n;for(n=t;e[n]&&!(n>=r);)++n;if(16<n-t&&e.buffer&&Xt)return Xt.decode(e.subarray(t,n));for(r="";t<n;){var o=e[t++];if(o&128){var s=e[t++]&63;if((o&224)==192)r+=String.fromCharCode((o&31)<<6|s);else{var h=e[t++]&63;o=(o&240)==224?(o&15)<<12|s<<6|h:(o&7)<<18|s<<12|h<<6|e[t++]&63,65536>o?r+=String.fromCharCode(o):(o-=65536,r+=String.fromCharCode(55296|o>>10,56320|o&1023))}}else r+=String.fromCharCode(o)}return r}function M(e,t){return e?we($,e,t):""}function fe(e,t,n,r){if(!(0<r))return 0;var o=n;r=n+r-1;for(var s=0;s<e.length;++s){var h=e.charCodeAt(s);if(55296<=h&&57343>=h){var _=e.charCodeAt(++s);h=65536+((h&1023)<<10)|_&1023}if(127>=h){if(n>=r)break;t[n++]=h}else{if(2047>=h){if(n+1>=r)break;t[n++]=192|h>>6}else{if(65535>=h){if(n+2>=r)break;t[n++]=224|h>>12}else{if(n+3>=r)break;t[n++]=240|h>>18,t[n++]=128|h>>12&63}t[n++]=128|h>>6&63}t[n++]=128|h&63}}return t[n]=0,n-o}function _e(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);55296<=r&&57343>=r&&(r=65536+((r&1023)<<10)|e.charCodeAt(++n)&1023),127>=r?++t:t=2047>=r?t+2:65535>=r?t+3:t+4}return t}function Zt(e){var t=_e(e)+1,n=Xe(t);return n&&fe(e,P,n,t),n}var _t,P,$,Fe,d,vt,St;function en(){var e=bt.buffer;_t=e,i.HEAP8=P=new Int8Array(e),i.HEAP16=Fe=new Int16Array(e),i.HEAP32=d=new Int32Array(e),i.HEAPU8=$=new Uint8Array(e),i.HEAPU16=new Uint16Array(e),i.HEAPU32=new Uint32Array(e),i.HEAPF32=vt=new Float32Array(e),i.HEAPF64=St=new Float64Array(e)}var pe,tn=[],nn=[],rn=[];function fr(){var e=i.preRun.shift();tn.unshift(e)}var me=0,kt=null,Le=null;i.preloadedImages={},i.preloadedAudios={};function se(e){throw i.onAbort&&i.onAbort(e),e="Aborted("+e+")",le(e),Yt=!0,new WebAssembly.RuntimeError(e+". Build with -s ASSERTIONS=1 for more info.")}function on(){return U.startsWith("data:application/octet-stream;base64,")}var U;if(U="sql-wasm.wasm",!on()){var sn=U;U=i.locateFile?i.locateFile(sn,B):B+sn}function an(){var e=U;try{if(e==U&&qe)return new Uint8Array(qe);if(G)return G(e);throw"both async and sync fetching of the wasm failed"}catch(t){se(t)}}function pr(){if(!qe&&(L||E)){if(typeof fetch=="function"&&!U.startsWith("file://"))return fetch(U,{credentials:"same-origin"}).then(function(e){if(!e.ok)throw"failed to load wasm binary file at '"+U+"'";return e.arrayBuffer()}).catch(function(){return an()});if(ie)return new Promise(function(e,t){ie(U,function(n){e(new Uint8Array(n))},t)})}return Promise.resolve().then(function(){return an()})}var A,j;function Dt(e){for(;0<e.length;){var t=e.shift();if(typeof t=="function")t(i);else{var n=t.Jb;typeof n=="number"?t.fb===void 0?Ge(n)():Ge(n)(t.fb):n(t.fb===void 0?null:t.fb)}}}var ve=[];function Ge(e){var t=ve[e];return t||(e>=ve.length&&(ve.length=e+1),ve[e]=t=pe.get(e)),t}function Et(e,t){for(var n=0,r=e.length-1;0<=r;r--){var o=e[r];o==="."?e.splice(r,1):o===".."?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n;n--)e.unshift("..");return e}function Z(e){var t=e.charAt(0)==="/",n=e.substr(-1)==="/";return(e=Et(e.split("/").filter(function(r){return!!r}),!t).join("/"))||t||(e="."),e&&n&&(e+="/"),(t?"/":"")+e}function mr(e){var t=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1);return e=t[0],t=t[1],!e&&!t?".":(t&&(t=t.substr(0,t.length-1)),e+t)}function Ue(e){if(e==="/")return"/";e=Z(e),e=e.replace(/\/$/,"");var t=e.lastIndexOf("/");return t===-1?e:e.substr(t+1)}function hr(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var e=new Uint8Array(1);return function(){return crypto.getRandomValues(e),e[0]}}if(q)try{var t=require("crypto");return function(){return t.randomBytes(1)[0]}}catch{}return function(){se("randomDevice")}}function je(){for(var e="",t=!1,n=arguments.length-1;-1<=n&&!t;n--){if(t=0<=n?arguments[n]:"/",typeof t!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!t)return"";e=t+"/"+e,t=t.charAt(0)==="/"}return e=Et(e.split("/").filter(function(r){return!!r}),!t).join("/"),(t?"/":"")+e||"."}var un=[];function ln(e,t){un[e]={input:[],output:[],Xa:t},xt(e,dr)}var dr={open:function(e){var t=un[e.node.rdev];if(!t)throw new l(43);e.tty=t,e.seekable=!1},close:function(e){e.tty.Xa.flush(e.tty)},flush:function(e){e.tty.Xa.flush(e.tty)},read:function(e,t,n,r){if(!e.tty||!e.tty.Xa.tb)throw new l(60);for(var o=0,s=0;s<r;s++){try{var h=e.tty.Xa.tb(e.tty)}catch{throw new l(29)}if(h===void 0&&o===0)throw new l(6);if(h==null)break;o++,t[n+s]=h}return o&&(e.node.timestamp=Date.now()),o},write:function(e,t,n,r){if(!e.tty||!e.tty.Xa.jb)throw new l(60);try{for(var o=0;o<r;o++)e.tty.Xa.jb(e.tty,t[n+o])}catch{throw new l(29)}return r&&(e.node.timestamp=Date.now()),o}},yr={tb:function(e){if(!e.input.length){var t=null;if(q){var n=Buffer.alloc(256),r=0;try{r=oe.readSync(process.stdin.fd,n,0,256,-1)}catch(o){if(o.toString().includes("EOF"))r=0;else throw o}0<r?t=n.slice(0,r).toString("utf-8"):t=null}else typeof window<"u"&&typeof window.prompt=="function"?(t=window.prompt("Input: "),t!==null&&(t+=`
`)):typeof readline=="function"&&(t=readline(),t!==null&&(t+=`
`));if(!t)return null;e.input=Pn(t,!0)}return e.input.shift()},jb:function(e,t){t===null||t===10?(Jt(we(e.output,0)),e.output=[]):t!=0&&e.output.push(t)},flush:function(e){e.output&&0<e.output.length&&(Jt(we(e.output,0)),e.output=[])}},gr={jb:function(e,t){t===null||t===10?(le(we(e.output,0)),e.output=[]):t!=0&&e.output.push(t)},flush:function(e){e.output&&0<e.output.length&&(le(we(e.output,0)),e.output=[])}},w={Pa:null,Qa:function(){return w.createNode(null,"/",16895,0)},createNode:function(e,t,n,r){if((n&61440)===24576||(n&61440)===4096)throw new l(63);return w.Pa||(w.Pa={dir:{node:{Oa:w.Ga.Oa,Na:w.Ga.Na,lookup:w.Ga.lookup,$a:w.Ga.$a,rename:w.Ga.rename,unlink:w.Ga.unlink,rmdir:w.Ga.rmdir,readdir:w.Ga.readdir,symlink:w.Ga.symlink},stream:{Ta:w.Ha.Ta}},file:{node:{Oa:w.Ga.Oa,Na:w.Ga.Na},stream:{Ta:w.Ha.Ta,read:w.Ha.read,write:w.Ha.write,lb:w.Ha.lb,ab:w.Ha.ab,bb:w.Ha.bb}},link:{node:{Oa:w.Ga.Oa,Na:w.Ga.Na,readlink:w.Ga.readlink},stream:{}},pb:{node:{Oa:w.Ga.Oa,Na:w.Ga.Na},stream:Sr}}),n=mn(e,t,n,r),(n.mode&61440)===16384?(n.Ga=w.Pa.dir.node,n.Ha=w.Pa.dir.stream,n.Ia={}):(n.mode&61440)===32768?(n.Ga=w.Pa.file.node,n.Ha=w.Pa.file.stream,n.Ma=0,n.Ia=null):(n.mode&61440)===40960?(n.Ga=w.Pa.link.node,n.Ha=w.Pa.link.stream):(n.mode&61440)===8192&&(n.Ga=w.Pa.pb.node,n.Ha=w.Pa.pb.stream),n.timestamp=Date.now(),e&&(e.Ia[t]=n,e.timestamp=n.timestamp),n},Kb:function(e){return e.Ia?e.Ia.subarray?e.Ia.subarray(0,e.Ma):new Uint8Array(e.Ia):new Uint8Array(0)},qb:function(e,t){var n=e.Ia?e.Ia.length:0;n>=t||(t=Math.max(t,n*(1048576>n?2:1.125)>>>0),n!=0&&(t=Math.max(t,256)),n=e.Ia,e.Ia=new Uint8Array(t),0<e.Ma&&e.Ia.set(n.subarray(0,e.Ma),0))},Gb:function(e,t){if(e.Ma!=t)if(t==0)e.Ia=null,e.Ma=0;else{var n=e.Ia;e.Ia=new Uint8Array(t),n&&e.Ia.set(n.subarray(0,Math.min(t,e.Ma))),e.Ma=t}},Ga:{Oa:function(e){var t={};return t.dev=(e.mode&61440)===8192?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,(e.mode&61440)===16384?t.size=4096:(e.mode&61440)===32768?t.size=e.Ma:(e.mode&61440)===40960?t.size=e.link.length:t.size=0,t.atime=new Date(e.timestamp),t.mtime=new Date(e.timestamp),t.ctime=new Date(e.timestamp),t.Ab=4096,t.blocks=Math.ceil(t.size/t.Ab),t},Na:function(e,t){t.mode!==void 0&&(e.mode=t.mode),t.timestamp!==void 0&&(e.timestamp=t.timestamp),t.size!==void 0&&w.Gb(e,t.size)},lookup:function(){throw At[44]},$a:function(e,t,n,r){return w.createNode(e,t,n,r)},rename:function(e,t,n){if((e.mode&61440)===16384){try{var r=he(t,n)}catch{}if(r)for(var o in r.Ia)throw new l(55)}delete e.parent.Ia[e.name],e.parent.timestamp=Date.now(),e.name=n,t.Ia[n]=e,t.timestamp=e.parent.timestamp,e.parent=t},unlink:function(e,t){delete e.Ia[t],e.timestamp=Date.now()},rmdir:function(e,t){var n=he(e,t),r;for(r in n.Ia)throw new l(55);delete e.Ia[t],e.timestamp=Date.now()},readdir:function(e){var t=[".",".."],n;for(n in e.Ia)e.Ia.hasOwnProperty(n)&&t.push(n);return t},symlink:function(e,t,n){return e=w.createNode(e,t,41471,0),e.link=n,e},readlink:function(e){if((e.mode&61440)!==40960)throw new l(28);return e.link}},Ha:{read:function(e,t,n,r,o){var s=e.node.Ia;if(o>=e.node.Ma)return 0;if(e=Math.min(e.node.Ma-o,r),8<e&&s.subarray)t.set(s.subarray(o,o+e),n);else for(r=0;r<e;r++)t[n+r]=s[o+r];return e},write:function(e,t,n,r,o,s){if(t.buffer===P.buffer&&(s=!1),!r)return 0;if(e=e.node,e.timestamp=Date.now(),t.subarray&&(!e.Ia||e.Ia.subarray)){if(s)return e.Ia=t.subarray(n,n+r),e.Ma=r;if(e.Ma===0&&o===0)return e.Ia=t.slice(n,n+r),e.Ma=r;if(o+r<=e.Ma)return e.Ia.set(t.subarray(n,n+r),o),r}if(w.qb(e,o+r),e.Ia.subarray&&t.subarray)e.Ia.set(t.subarray(n,n+r),o);else for(s=0;s<r;s++)e.Ia[o+s]=t[n+s];return e.Ma=Math.max(e.Ma,o+r),r},Ta:function(e,t,n){if(n===1?t+=e.position:n===2&&(e.node.mode&61440)===32768&&(t+=e.node.Ma),0>t)throw new l(28);return t},lb:function(e,t,n){w.qb(e.node,t+n),e.node.Ma=Math.max(e.node.Ma,t+n)},ab:function(e,t,n,r,o,s){if(t!==0)throw new l(28);if((e.node.mode&61440)!==32768)throw new l(43);if(e=e.node.Ia,s&2||e.buffer!==_t){if((0<r||r+n<e.length)&&(e.subarray?e=e.subarray(r,r+n):e=Array.prototype.slice.call(e,r,r+n)),r=!0,n=65536*Math.ceil(n/65536),(s=Tn(65536,n))?($.fill(0,s,s+n),n=s):n=0,!n)throw new l(48);P.set(e,n)}else r=!1,n=e.byteOffset;return{Fb:n,vb:r}},bb:function(e,t,n,r,o){if((e.node.mode&61440)!==32768)throw new l(43);return o&2||w.Ha.write(e,t,0,r,n,!1),0}}},It=null,cn={},z=[],br=1,ae=null,fn=!0,l=null,At={},N=(e,t={})=>{if(e=je("/",e),!e)return{path:"",node:null};if(t=Object.assign({rb:!0,kb:0},t),8<t.kb)throw new l(32);e=Et(e.split("/").filter(h=>!!h),!1);for(var n=It,r="/",o=0;o<e.length;o++){var s=o===e.length-1;if(s&&t.parent)break;if(n=he(n,e[o]),r=Z(r+"/"+e[o]),n.Va&&(!s||s&&t.rb)&&(n=n.Va.root),!s||t.Sa){for(s=0;(n.mode&61440)===40960;)if(n=_n(r),r=je(mr(r),n),n=N(r,{kb:t.kb+1}).node,40<s++)throw new l(32)}}return{path:r,node:n}},Be=e=>{for(var t;;){if(e===e.parent)return e=e.Qa.ub,t?e[e.length-1]!=="/"?e+"/"+t:e+t:e;t=t?e.name+"/"+t:e.name,e=e.parent}},qt=(e,t)=>{for(var n=0,r=0;r<t.length;r++)n=(n<<5)-n+t.charCodeAt(r)|0;return(e+n>>>0)%ae.length},pn=e=>{var t=qt(e.parent.id,e.name);if(ae[t]===e)ae[t]=e.Wa;else for(t=ae[t];t;){if(t.Wa===e){t.Wa=e.Wa;break}t=t.Wa}},he=(e,t)=>{var n;if(n=(n=Se(e,"x"))?n:e.Ga.lookup?0:2)throw new l(n,e);for(n=ae[qt(e.id,t)];n;n=n.Wa){var r=n.name;if(n.parent.id===e.id&&r===t)return n}return e.Ga.lookup(e,t)},mn=(e,t,n,r)=>(e=new Bn(e,t,n,r),t=qt(e.parent.id,e.name),e.Wa=ae[t],ae[t]=e),wr={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},hn=e=>{var t=["r","w","rw"][e&3];return e&512&&(t+="w"),t},Se=(e,t)=>{if(fn)return 0;if(!t.includes("r")||e.mode&292){if(t.includes("w")&&!(e.mode&146)||t.includes("x")&&!(e.mode&73))return 2}else return 2;return 0},dn=(e,t)=>{try{return he(e,t),20}catch{}return Se(e,"wx")},yn=(e,t,n)=>{try{var r=he(e,t)}catch(o){return o.Ka}if(e=Se(e,"wx"))return e;if(n){if((r.mode&61440)!==16384)return 54;if(r===r.parent||Be(r)==="/")return 10}else if((r.mode&61440)===16384)return 31;return 0},_r=(e=0,t=4096)=>{for(;e<=t;e++)if(!z[e])return e;throw new l(33)},vr=(e,t)=>(Qe||(Qe=function(){},Qe.prototype={}),e=Object.assign(new Qe,e),t=_r(t,void 0),e.fd=t,z[t]=e),Sr={open:e=>{e.Ha=cn[e.node.rdev].Ha,e.Ha.open&&e.Ha.open(e)},Ta:()=>{throw new l(70)}},xt=(e,t)=>{cn[e]={Ha:t}},gn=(e,t)=>{var n=t==="/",r=!t;if(n&&It)throw new l(10);if(!n&&!r){var o=N(t,{rb:!1});if(t=o.path,o=o.node,o.Va)throw new l(10);if((o.mode&61440)!==16384)throw new l(54)}t={type:e,Lb:{},ub:t,Eb:[]},e=e.Qa(t),e.Qa=t,t.root=e,n?It=e:o&&(o.Va=t,o.Qa&&o.Qa.Eb.push(t))},$e=(e,t,n)=>{var r=N(e,{parent:!0}).node;if(e=Ue(e),!e||e==="."||e==="..")throw new l(28);var o=dn(r,e);if(o)throw new l(o);if(!r.Ga.$a)throw new l(63);return r.Ga.$a(r,e,t,n)},V=(e,t)=>$e(e,(t!==void 0?t:511)&1023|16384,0),ze=(e,t,n)=>{typeof n>"u"&&(n=t,t=438),$e(e,t|8192,n)},Lt=(e,t)=>{if(!je(e))throw new l(44);var n=N(t,{parent:!0}).node;if(!n)throw new l(44);t=Ue(t);var r=dn(n,t);if(r)throw new l(r);if(!n.Ga.symlink)throw new l(63);n.Ga.symlink(n,t,e)},bn=e=>{var t=N(e,{parent:!0}).node;e=Ue(e);var n=he(t,e),r=yn(t,e,!0);if(r)throw new l(r);if(!t.Ga.rmdir)throw new l(63);if(n.Va)throw new l(10);t.Ga.rmdir(t,e),pn(n)},wn=e=>{var t=N(e,{parent:!0}).node;if(!t)throw new l(44);e=Ue(e);var n=he(t,e),r=yn(t,e,!1);if(r)throw new l(r);if(!t.Ga.unlink)throw new l(63);if(n.Va)throw new l(10);t.Ga.unlink(t,e),pn(n)},_n=e=>{if(e=N(e).node,!e)throw new l(44);if(!e.Ga.readlink)throw new l(28);return je(Be(e.parent),e.Ga.readlink(e))},Pe=(e,t)=>{if(e=N(e,{Sa:!t}).node,!e)throw new l(44);if(!e.Ga.Oa)throw new l(63);return e.Ga.Oa(e)},vn=e=>Pe(e,!0),Ke=(e,t)=>{if(e=typeof e=="string"?N(e,{Sa:!0}).node:e,!e.Ga.Na)throw new l(63);e.Ga.Na(e,{mode:t&4095|e.mode&-4096,timestamp:Date.now()})},Sn=(e,t)=>{if(0>t)throw new l(28);if(e=typeof e=="string"?N(e,{Sa:!0}).node:e,!e.Ga.Na)throw new l(63);if((e.mode&61440)===16384)throw new l(31);if((e.mode&61440)!==32768)throw new l(28);var n=Se(e,"w");if(n)throw new l(n);e.Ga.Na(e,{size:t,timestamp:Date.now()})},de=(e,t,n,r)=>{if(e==="")throw new l(44);if(typeof t=="string"){var o=wr[t];if(typeof o>"u")throw Error("Unknown file open mode: "+t);t=o}if(n=t&64?(typeof n>"u"?438:n)&4095|32768:0,typeof e=="object")var s=e;else{e=Z(e);try{s=N(e,{Sa:!(t&131072)}).node}catch{}}if(o=!1,t&64)if(s){if(t&128)throw new l(20)}else s=$e(e,n,0),o=!0;if(!s)throw new l(44);if((s.mode&61440)===8192&&(t&=-513),t&65536&&(s.mode&61440)!==16384)throw new l(54);if(!o&&(n=s?(s.mode&61440)===40960?32:(s.mode&61440)===16384&&(hn(t)!=="r"||t&512)?31:Se(s,hn(t)):44))throw new l(n);return t&512&&Sn(s,0),t&=-131713,r=vr({node:s,path:Be(s),flags:t,seekable:!0,position:0,Ha:s.Ha,Ib:[],error:!1},r),r.Ha.open&&r.Ha.open(r),!i.logReadFiles||t&1||(We||(We={}),e in We||(We[e]=1)),r},Bt=e=>{if(e.fd===null)throw new l(8);e.hb&&(e.hb=null);try{e.Ha.close&&e.Ha.close(e)}catch(t){throw t}finally{z[e.fd]=null}e.fd=null},kn=(e,t,n)=>{if(e.fd===null)throw new l(8);if(!e.seekable||!e.Ha.Ta)throw new l(70);if(n!=0&&n!=1&&n!=2)throw new l(28);e.position=e.Ha.Ta(e,t,n),e.Ib=[]},Dn=(e,t,n,r,o)=>{if(0>r||0>o)throw new l(28);if(e.fd===null)throw new l(8);if((e.flags&2097155)===1)throw new l(8);if((e.node.mode&61440)===16384)throw new l(31);if(!e.Ha.read)throw new l(28);var s=typeof o<"u";if(!s)o=e.position;else if(!e.seekable)throw new l(70);return t=e.Ha.read(e,t,n,r,o),s||(e.position+=t),t},En=(e,t,n,r,o,s)=>{if(0>r||0>o)throw new l(28);if(e.fd===null)throw new l(8);if((e.flags&2097155)===0)throw new l(8);if((e.node.mode&61440)===16384)throw new l(31);if(!e.Ha.write)throw new l(28);e.seekable&&e.flags&1024&&kn(e,0,2);var h=typeof o<"u";if(!h)o=e.position;else if(!e.seekable)throw new l(70);return t=e.Ha.write(e,t,n,r,o,s),h||(e.position+=t),t},kr=e=>{var t="binary";if(t!=="utf8"&&t!=="binary")throw Error('Invalid encoding type "'+t+'"');var n,r=de(e,r||0);e=Pe(e).size;var o=new Uint8Array(e);return Dn(r,o,0,e,0),t==="utf8"?n=we(o,0):t==="binary"&&(n=o),Bt(r),n},In=()=>{l||(l=function(e,t){this.node=t,this.Hb=function(n){this.Ka=n},this.Hb(e),this.message="FS error"},l.prototype=Error(),l.prototype.constructor=l,[44].forEach(e=>{At[e]=new l(e),At[e].stack="<generic error, no stack>"}))},An,qn=(e,t)=>{var n=0;return e&&(n|=365),t&&(n|=146),n},Re=(e,t,n)=>{e=Z("/dev/"+e);var r=qn(!!t,!!n);Pt||(Pt=64);var o=Pt++<<8|0;xt(o,{open:s=>{s.seekable=!1},close:()=>{n&&n.buffer&&n.buffer.length&&n(10)},read:(s,h,_,v)=>{for(var D=0,C=0;C<v;C++){try{var te=t()}catch{throw new l(29)}if(te===void 0&&D===0)throw new l(6);if(te==null)break;D++,h[_+C]=te}return D&&(s.node.timestamp=Date.now()),D},write:(s,h,_,v)=>{for(var D=0;D<v;D++)try{n(h[_+D])}catch{throw new l(29)}return v&&(s.node.timestamp=Date.now()),D}}),ze(e,r,o)},Pt,I={},Qe,We;function ke(e,t,n){if(t[0]==="/")return t;if(e===-100)e="/";else{if(e=z[e],!e)throw new l(8);e=e.path}if(t.length==0){if(!n)throw new l(44);return e}return Z(e+"/"+t)}function Ve(e,t,n){try{var r=e(t)}catch(o){if(o&&o.node&&Z(t)!==Z(Be(o.node)))return-54;throw o}return d[n>>2]=r.dev,d[n+4>>2]=0,d[n+8>>2]=r.ino,d[n+12>>2]=r.mode,d[n+16>>2]=r.nlink,d[n+20>>2]=r.uid,d[n+24>>2]=r.gid,d[n+28>>2]=r.rdev,d[n+32>>2]=0,j=[r.size>>>0,(A=r.size,1<=+Math.abs(A)?0<A?(Math.min(+Math.floor(A/4294967296),4294967295)|0)>>>0:~~+Math.ceil((A-+(~~A>>>0))/4294967296)>>>0:0)],d[n+40>>2]=j[0],d[n+44>>2]=j[1],d[n+48>>2]=4096,d[n+52>>2]=r.blocks,d[n+56>>2]=r.atime.getTime()/1e3|0,d[n+60>>2]=0,d[n+64>>2]=r.mtime.getTime()/1e3|0,d[n+68>>2]=0,d[n+72>>2]=r.ctime.getTime()/1e3|0,d[n+76>>2]=0,j=[r.ino>>>0,(A=r.ino,1<=+Math.abs(A)?0<A?(Math.min(+Math.floor(A/4294967296),4294967295)|0)>>>0:~~+Math.ceil((A-+(~~A>>>0))/4294967296)>>>0:0)],d[n+80>>2]=j[0],d[n+84>>2]=j[1],0}var Je=void 0;function Ye(){return Je+=4,d[Je-4>>2]}function ue(e){if(e=z[e],!e)throw new l(8);return e}function Dr(e,t,n){function r(v){return(v=v.toTimeString().match(/\(([A-Za-z ]+)\)$/))?v[1]:"GMT"}var o=new Date().getFullYear(),s=new Date(o,0,1),h=new Date(o,6,1);o=s.getTimezoneOffset();var _=h.getTimezoneOffset();d[e>>2]=60*Math.max(o,_),d[t>>2]=+(o!=_),e=r(s),t=r(h),e=Zt(e),t=Zt(t),_<o?(d[n>>2]=e,d[n+4>>2]=t):(d[n>>2]=t,d[n+4>>2]=e)}function Rt(e,t,n){Rt.Bb||(Rt.Bb=!0,Dr(e,t,n))}var xn;xn=q?()=>{var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:()=>performance.now();var Tt={};function Ln(){if(!Mt){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:S||"./this.program"},t;for(t in Tt)Tt[t]===void 0?delete e[t]:e[t]=Tt[t];var n=[];for(t in e)n.push(t+"="+e[t]);Mt=n}return Mt}var Mt;function Bn(e,t,n,r){e||(e=this),this.parent=e,this.Qa=e.Qa,this.Va=null,this.id=br++,this.name=t,this.mode=n,this.Ga={},this.Ha={},this.rdev=r}Object.defineProperties(Bn.prototype,{read:{get:function(){return(this.mode&365)===365},set:function(e){e?this.mode|=365:this.mode&=-366}},write:{get:function(){return(this.mode&146)===146},set:function(e){e?this.mode|=146:this.mode&=-147}}}),In(),ae=Array(4096),gn(w,"/"),V("/tmp"),V("/home"),V("/home/web_user"),(()=>{V("/dev"),xt(259,{read:()=>0,write:(t,n,r,o)=>o}),ze("/dev/null",259),ln(1280,yr),ln(1536,gr),ze("/dev/tty",1280),ze("/dev/tty1",1536);var e=hr();Re("random",e),Re("urandom",e),V("/dev/shm"),V("/dev/shm/tmp")})(),(()=>{V("/proc");var e=V("/proc/self");V("/proc/self/fd"),gn({Qa:()=>{var t=mn(e,"fd",16895,73);return t.Ga={lookup:(n,r)=>{var o=z[+r];if(!o)throw new l(8);return n={parent:null,Qa:{ub:"fake"},Ga:{readlink:()=>o.path}},n.parent=n}},t}},"/proc/self/fd")})();function Pn(e,t){var n=Array(_e(e)+1);return e=fe(e,n,0,n.length),t&&(n.length=e),n}var Er={a:function(e,t,n,r){se("Assertion failed: "+M(e)+", at: "+[t?M(t):"unknown filename",n,r?M(r):"unknown function"])},g:function(e,t){try{return e=M(e),Ke(e,t),0}catch(n){if(typeof I>"u"||!(n instanceof l))throw n;return-n.Ka}},I:function(e,t,n){try{if(t=M(t),t=ke(e,t),n&-8)var r=-28;else{var o=N(t,{Sa:!0}).node;o?(e="",n&4&&(e+="r"),n&2&&(e+="w"),n&1&&(e+="x"),r=e&&Se(o,e)?-2:0):r=-44}return r}catch(s){if(typeof I>"u"||!(s instanceof l))throw s;return-s.Ka}},h:function(e,t){try{var n=z[e];if(!n)throw new l(8);return Ke(n.node,t),0}catch(r){if(typeof I>"u"||!(r instanceof l))throw r;return-r.Ka}},H:function(e){try{var t=z[e];if(!t)throw new l(8);var n=t.node,r=typeof n=="string"?N(n,{Sa:!0}).node:n;if(!r.Ga.Na)throw new l(63);return r.Ga.Na(r,{timestamp:Date.now()}),0}catch(o){if(typeof I>"u"||!(o instanceof l))throw o;return-o.Ka}},b:function(e,t,n){Je=n;try{var r=ue(e);switch(t){case 0:var o=Ye();return 0>o?-28:de(r.path,r.flags,0,o).fd;case 1:case 2:return 0;case 3:return r.flags;case 4:return o=Ye(),r.flags|=o,0;case 5:return o=Ye(),Fe[o+0>>1]=2,0;case 6:case 7:return 0;case 16:case 8:return-28;case 9:return d[Rn()>>2]=28,-1;default:return-28}}catch(s){if(typeof I>"u"||!(s instanceof l))throw s;return-s.Ka}},G:function(e,t){try{var n=ue(e);return Ve(Pe,n.path,t)}catch(r){if(typeof I>"u"||!(r instanceof l))throw r;return-r.Ka}},B:function(e,t){try{var n=z[e];if(!n)throw new l(8);if((n.flags&2097155)===0)throw new l(28);return Sn(n.node,t),0}catch(r){if(typeof I>"u"||!(r instanceof l))throw r;return-r.Ka}},A:function(e,t){try{return t===0?-28:t<_e("/")+1?-68:(fe("/",$,e,t),e)}catch(n){if(typeof I>"u"||!(n instanceof l))throw n;return-n.Ka}},E:function(e,t){try{return e=M(e),Ve(vn,e,t)}catch(n){if(typeof I>"u"||!(n instanceof l))throw n;return-n.Ka}},x:function(e,t){try{return e=M(e),e=Z(e),e[e.length-1]==="/"&&(e=e.substr(0,e.length-1)),V(e,t),0}catch(n){if(typeof I>"u"||!(n instanceof l))throw n;return-n.Ka}},D:function(e,t,n,r){try{t=M(t);var o=r&256;return t=ke(e,t,r&4096),Ve(o?vn:Pe,t,n)}catch(s){if(typeof I>"u"||!(s instanceof l))throw s;return-s.Ka}},u:function(e,t,n,r){Je=r;try{t=M(t),t=ke(e,t);var o=r?Ye():0;return de(t,n,o).fd}catch(s){if(typeof I>"u"||!(s instanceof l))throw s;return-s.Ka}},s:function(e,t,n,r){try{if(t=M(t),t=ke(e,t),0>=r)var o=-28;else{var s=_n(t),h=Math.min(r,_e(s)),_=P[n+h];fe(s,$,n,r+1),P[n+h]=_,o=h}return o}catch(v){if(typeof I>"u"||!(v instanceof l))throw v;return-v.Ka}},r:function(e){try{return e=M(e),bn(e),0}catch(t){if(typeof I>"u"||!(t instanceof l))throw t;return-t.Ka}},F:function(e,t){try{return e=M(e),Ve(Pe,e,t)}catch(n){if(typeof I>"u"||!(n instanceof l))throw n;return-n.Ka}},n:function(e,t,n){try{return t=M(t),t=ke(e,t),n===0?wn(t):n===512?bn(t):se("Invalid flags passed to unlinkat"),0}catch(r){if(typeof I>"u"||!(r instanceof l))throw r;return-r.Ka}},m:function(e,t,n){try{if(t=M(t),t=ke(e,t,!0),n){var r=d[n>>2],o=d[n+4>>2];s=1e3*r+o/1e6,n+=8,r=d[n>>2],o=d[n+4>>2],h=1e3*r+o/1e6}else var s=Date.now(),h=s;e=s;var _=N(t,{Sa:!0}).node;return _.Ga.Na(_,{timestamp:Math.max(e,h)}),0}catch(v){if(typeof I>"u"||!(v instanceof l))throw v;return-v.Ka}},e:function(){return Date.now()},i:function(e,t){e=new Date(1e3*d[e>>2]),d[t>>2]=e.getSeconds(),d[t+4>>2]=e.getMinutes(),d[t+8>>2]=e.getHours(),d[t+12>>2]=e.getDate(),d[t+16>>2]=e.getMonth(),d[t+20>>2]=e.getFullYear()-1900,d[t+24>>2]=e.getDay();var n=new Date(e.getFullYear(),0,1);d[t+28>>2]=(e.getTime()-n.getTime())/864e5|0,d[t+36>>2]=-(60*e.getTimezoneOffset());var r=new Date(e.getFullYear(),6,1).getTimezoneOffset();n=n.getTimezoneOffset(),d[t+32>>2]=(r!=n&&e.getTimezoneOffset()==Math.min(n,r))|0},v:function(e,t,n,r,o,s,h){try{var _=z[o];if(!_)return-8;if((n&2)!==0&&(r&2)===0&&(_.flags&2097155)!==2)throw new l(2);if((_.flags&2097155)===1)throw new l(2);if(!_.Ha.ab)throw new l(43);var v=_.Ha.ab(_,e,t,s,n,r),D=v.Fb;return d[h>>2]=v.vb,D}catch(C){if(typeof I>"u"||!(C instanceof l))throw C;return-C.Ka}},w:function(e,t,n,r,o,s){try{var h=z[o];if(h&&n&2){var _=$.slice(e,e+t);h&&h.Ha.bb&&h.Ha.bb(h,_,s,t,r)}}catch(v){if(typeof I>"u"||!(v instanceof l))throw v;return-v.Ka}},j:Rt,p:function(){return 2147483648},d:xn,o:function(e,t,n){$.copyWithin(e,t,t+n)},c:function(e){var t=$.length;if(e>>>=0,2147483648<e)return!1;for(var n=1;4>=n;n*=2){var r=t*(1+.2/n);r=Math.min(r,e+100663296);var o=Math;r=Math.max(e,r),o=o.min.call(o,2147483648,r+(65536-r%65536)%65536);e:{try{bt.grow(o-_t.byteLength+65535>>>16),en();var s=1;break e}catch{}s=void 0}if(s)return!0}return!1},y:function(e,t){var n=0;return Ln().forEach(function(r,o){var s=t+n;for(o=d[e+4*o>>2]=s,s=0;s<r.length;++s)P[o++>>0]=r.charCodeAt(s);P[o>>0]=0,n+=r.length+1}),0},z:function(e,t){var n=Ln();d[e>>2]=n.length;var r=0;return n.forEach(function(o){r+=o.length+1}),d[t>>2]=r,0},f:function(e){try{var t=ue(e);return Bt(t),0}catch(n){if(typeof I>"u"||!(n instanceof l))throw n;return n.Ka}},l:function(e,t){try{var n=ue(e);return P[t>>0]=n.tty?2:(n.mode&61440)===16384?3:(n.mode&61440)===40960?7:4,0}catch(r){if(typeof I>"u"||!(r instanceof l))throw r;return r.Ka}},t:function(e,t,n,r){try{e:{for(var o=ue(e),s=e=0;s<n;s++){var h=d[t+(8*s+4)>>2],_=Dn(o,P,d[t+8*s>>2],h,void 0);if(0>_){var v=-1;break e}if(e+=_,_<h)break}v=e}return d[r>>2]=v,0}catch(D){if(typeof I>"u"||!(D instanceof l))throw D;return D.Ka}},k:function(e,t,n,r,o){try{var s=ue(e);return e=4294967296*n+(t>>>0),-9007199254740992>=e||9007199254740992<=e?-61:(kn(s,e,r),j=[s.position>>>0,(A=s.position,1<=+Math.abs(A)?0<A?(Math.min(+Math.floor(A/4294967296),4294967295)|0)>>>0:~~+Math.ceil((A-+(~~A>>>0))/4294967296)>>>0:0)],d[o>>2]=j[0],d[o+4>>2]=j[1],s.hb&&e===0&&r===0&&(s.hb=null),0)}catch(h){if(typeof I>"u"||!(h instanceof l))throw h;return h.Ka}},C:function(e){try{var t=ue(e);return t.Ha&&t.Ha.fsync?-t.Ha.fsync(t):0}catch(n){if(typeof I>"u"||!(n instanceof l))throw n;return n.Ka}},q:function(e,t,n,r){try{e:{for(var o=ue(e),s=e=0;s<n;s++){var h=En(o,P,d[t+8*s>>2],d[t+(8*s+4)>>2],void 0);if(0>h){var _=-1;break e}e+=h}_=e}return d[r>>2]=_,0}catch(v){if(typeof I>"u"||!(v instanceof l))throw v;return v.Ka}}};(function(){function e(o){i.asm=o.exports,bt=i.asm.J,en(),pe=i.asm.Aa,nn.unshift(i.asm.K),me--,i.monitorRunDependencies&&i.monitorRunDependencies(me),me==0&&(kt!==null&&(clearInterval(kt),kt=null),Le&&(o=Le,Le=null,o()))}function t(o){e(o.instance)}function n(o){return pr().then(function(s){return WebAssembly.instantiate(s,r)}).then(function(s){return s}).then(o,function(s){le("failed to asynchronously prepare wasm: "+s),se(s)})}var r={a:Er};if(me++,i.monitorRunDependencies&&i.monitorRunDependencies(me),i.instantiateWasm)try{return i.instantiateWasm(r,e)}catch(o){return le("Module.instantiateWasm callback failed with error: "+o),!1}return function(){return qe||typeof WebAssembly.instantiateStreaming!="function"||on()||U.startsWith("file://")||typeof fetch!="function"?n(t):fetch(U,{credentials:"same-origin"}).then(function(o){return WebAssembly.instantiateStreaming(o,r).then(t,function(s){return le("wasm streaming compile failed: "+s),le("falling back to ArrayBuffer instantiation"),n(t)})})}(),{}})(),i.___wasm_call_ctors=function(){return(i.___wasm_call_ctors=i.asm.K).apply(null,arguments)},i._sqlite3_free=function(){return(i._sqlite3_free=i.asm.L).apply(null,arguments)};var Rn=i.___errno_location=function(){return(Rn=i.___errno_location=i.asm.M).apply(null,arguments)};i._sqlite3_step=function(){return(i._sqlite3_step=i.asm.N).apply(null,arguments)},i._sqlite3_finalize=function(){return(i._sqlite3_finalize=i.asm.O).apply(null,arguments)},i._sqlite3_prepare_v2=function(){return(i._sqlite3_prepare_v2=i.asm.P).apply(null,arguments)},i._sqlite3_reset=function(){return(i._sqlite3_reset=i.asm.Q).apply(null,arguments)},i._sqlite3_clear_bindings=function(){return(i._sqlite3_clear_bindings=i.asm.R).apply(null,arguments)},i._sqlite3_value_blob=function(){return(i._sqlite3_value_blob=i.asm.S).apply(null,arguments)},i._sqlite3_value_text=function(){return(i._sqlite3_value_text=i.asm.T).apply(null,arguments)},i._sqlite3_value_bytes=function(){return(i._sqlite3_value_bytes=i.asm.U).apply(null,arguments)},i._sqlite3_value_double=function(){return(i._sqlite3_value_double=i.asm.V).apply(null,arguments)},i._sqlite3_value_int=function(){return(i._sqlite3_value_int=i.asm.W).apply(null,arguments)},i._sqlite3_value_type=function(){return(i._sqlite3_value_type=i.asm.X).apply(null,arguments)},i._sqlite3_result_blob=function(){return(i._sqlite3_result_blob=i.asm.Y).apply(null,arguments)},i._sqlite3_result_double=function(){return(i._sqlite3_result_double=i.asm.Z).apply(null,arguments)},i._sqlite3_result_error=function(){return(i._sqlite3_result_error=i.asm._).apply(null,arguments)},i._sqlite3_result_int=function(){return(i._sqlite3_result_int=i.asm.$).apply(null,arguments)},i._sqlite3_result_int64=function(){return(i._sqlite3_result_int64=i.asm.aa).apply(null,arguments)},i._sqlite3_result_null=function(){return(i._sqlite3_result_null=i.asm.ba).apply(null,arguments)},i._sqlite3_result_text=function(){return(i._sqlite3_result_text=i.asm.ca).apply(null,arguments)},i._sqlite3_column_count=function(){return(i._sqlite3_column_count=i.asm.da).apply(null,arguments)},i._sqlite3_data_count=function(){return(i._sqlite3_data_count=i.asm.ea).apply(null,arguments)},i._sqlite3_column_blob=function(){return(i._sqlite3_column_blob=i.asm.fa).apply(null,arguments)},i._sqlite3_column_bytes=function(){return(i._sqlite3_column_bytes=i.asm.ga).apply(null,arguments)},i._sqlite3_column_double=function(){return(i._sqlite3_column_double=i.asm.ha).apply(null,arguments)},i._sqlite3_column_text=function(){return(i._sqlite3_column_text=i.asm.ia).apply(null,arguments)},i._sqlite3_column_type=function(){return(i._sqlite3_column_type=i.asm.ja).apply(null,arguments)},i._sqlite3_column_name=function(){return(i._sqlite3_column_name=i.asm.ka).apply(null,arguments)},i._sqlite3_bind_blob=function(){return(i._sqlite3_bind_blob=i.asm.la).apply(null,arguments)},i._sqlite3_bind_double=function(){return(i._sqlite3_bind_double=i.asm.ma).apply(null,arguments)},i._sqlite3_bind_int=function(){return(i._sqlite3_bind_int=i.asm.na).apply(null,arguments)},i._sqlite3_bind_text=function(){return(i._sqlite3_bind_text=i.asm.oa).apply(null,arguments)},i._sqlite3_bind_parameter_index=function(){return(i._sqlite3_bind_parameter_index=i.asm.pa).apply(null,arguments)},i._sqlite3_sql=function(){return(i._sqlite3_sql=i.asm.qa).apply(null,arguments)},i._sqlite3_normalized_sql=function(){return(i._sqlite3_normalized_sql=i.asm.ra).apply(null,arguments)},i._sqlite3_errmsg=function(){return(i._sqlite3_errmsg=i.asm.sa).apply(null,arguments)},i._sqlite3_exec=function(){return(i._sqlite3_exec=i.asm.ta).apply(null,arguments)},i._sqlite3_changes=function(){return(i._sqlite3_changes=i.asm.ua).apply(null,arguments)},i._sqlite3_close_v2=function(){return(i._sqlite3_close_v2=i.asm.va).apply(null,arguments)},i._sqlite3_create_function_v2=function(){return(i._sqlite3_create_function_v2=i.asm.wa).apply(null,arguments)},i._sqlite3_open=function(){return(i._sqlite3_open=i.asm.xa).apply(null,arguments)};var Xe=i._malloc=function(){return(Xe=i._malloc=i.asm.ya).apply(null,arguments)},Ze=i._free=function(){return(Ze=i._free=i.asm.za).apply(null,arguments)};i._RegisterExtensionFunctions=function(){return(i._RegisterExtensionFunctions=i.asm.Ba).apply(null,arguments)};var Tn=i._emscripten_builtin_memalign=function(){return(Tn=i._emscripten_builtin_memalign=i.asm.Ca).apply(null,arguments)},Te=i.stackSave=function(){return(Te=i.stackSave=i.asm.Da).apply(null,arguments)},Me=i.stackRestore=function(){return(Me=i.stackRestore=i.asm.Ea).apply(null,arguments)},ee=i.stackAlloc=function(){return(ee=i.stackAlloc=i.asm.Fa).apply(null,arguments)};i.cwrap=function(e,t,n,r){n=n||[];var o=n.every(function(s){return s==="number"});return t!=="string"&&o&&!r?i["_"+e]:function(){return ur(e,t,n,arguments)}},i.UTF8ToString=M,i.stackSave=Te,i.stackRestore=Me,i.stackAlloc=ee;var et;Le=function e(){et||Ct(),et||(Le=e)};function Ct(){function e(){if(!et&&(et=!0,i.calledRun=!0,!Yt)){if(i.noFSInit||An||(An=!0,In(),i.stdin=i.stdin,i.stdout=i.stdout,i.stderr=i.stderr,i.stdin?Re("stdin",i.stdin):Lt("/dev/tty","/dev/stdin"),i.stdout?Re("stdout",null,i.stdout):Lt("/dev/tty","/dev/stdout"),i.stderr?Re("stderr",null,i.stderr):Lt("/dev/tty1","/dev/stderr"),de("/dev/stdin",0),de("/dev/stdout",1),de("/dev/stderr",1)),fn=!1,Dt(nn),i.onRuntimeInitialized&&i.onRuntimeInitialized(),i.postRun)for(typeof i.postRun=="function"&&(i.postRun=[i.postRun]);i.postRun.length;){var t=i.postRun.shift();rn.unshift(t)}Dt(rn)}}if(!(0<me)){if(i.preRun)for(typeof i.preRun=="function"&&(i.preRun=[i.preRun]);i.preRun.length;)fr();Dt(tn),0<me||(i.setStatus?(i.setStatus("Running..."),setTimeout(function(){setTimeout(function(){i.setStatus("")},1),e()},1)):e())}}if(i.run=Ct,i.preInit)for(typeof i.preInit=="function"&&(i.preInit=[i.preInit]);0<i.preInit.length;)i.preInit.pop()();return Ct(),m}),ct)};typeof pt=="object"&&typeof be=="object"?(be.exports=ft,be.exports.default=ft):typeof define=="function"&&define.amd?define([],function(){return ft}):typeof pt=="object"&&(pt.Module=ft)});var vi={};si(vi,{default:()=>or});module.exports=ai(vi);var Ae=require("react");var st=require("react");var rt=`
SELECT id, content, type, entityType, documentId
FROM BlockSearch(?)
ORDER BY rank + customRank
LIMIT ?
`,Un=`
SELECT id, content, type, entityType, documentId
FROM BlockSearch
ORDER BY customRank
LIMIT ?
`,jn=`
SELECT id, content, type, entityType, documentId
FROM BlockSearch
WHERE entityType = 'document'
ORDER BY customRank
LIMIT ?
`,Ee=40,it=c=>{if(!c||c.length===0)return"";let u=fi(c);return`{content exactMatchContent} : (${pi(u).join(") OR (")})`},ot=(c,u,p,m)=>{try{return c.exec(p,m).map(y=>y.values).flat().map(Qn(u))}catch(y){return console.error(`db exec error: ${y}`),[]}},$n=(c,u)=>{if(u.length===0)return[];let p=Kn(u),y=`select documentId, content from BlockSearch where entityType = 'document' and documentId in (${new Array(p.length).fill("?").join(", ")})`;try{return c.exec(y,p).map(i=>i.values).flat().map(([i,k])=>u.filter(S=>S.documentID===i).forEach(S=>S.documentName=k)),u}catch(i){return console.error(`db exec error: ${i}`),[]}},zn=(c,u,p)=>{if(p.length===0)return[];let m=Kn(p),i=`SELECT id, content, type, entityType, documentId FROM BlockSearch WHERE documentId in (${new Array(m.length).fill("?").join(", ")})`;try{return c.exec(i,m).map(k=>k.values).flat().reduce(ui(u),[])}catch(k){return console.error(`db exec error: ${k}`),[]}},ui=c=>(u,p)=>{let m=Qn(c)(p),y=u.find(i=>i.block.documentID===m.documentID);return y?ci(y,m):u.push(li(m)),u},li=c=>c.entityType==="document"?{block:c,blocks:[]}:{block:{documentID:c.documentID},blocks:[c]},ci=(c,u)=>{u.entityType==="document"?c.block=u:c.blocks.push(u)},Kn=c=>[...new Set(c.map(u=>u.documentID))],fi=c=>c.split(/\s+/).map(u=>u.trim()).map(u=>u.replace('"'," ")).map(u=>`"${u}"`),pi=c=>{let u=[c.join(" "),c.join(" ")+"*"];return c.length>1&&u.push(c.join("* ")+"*"),u},Qn=c=>([u,p,m,y,i])=>({id:u,content:p,type:m,entityType:y,documentID:i,spaceID:c});function Nt({databasesLoading:c,databases:u},p){let[m,y]=(0,st.useState)({resultsLoading:!0,results:[]});return(0,st.useEffect)(()=>{if(c)return;y(q=>({...q,resultsLoading:!0}));let i=it(p),[k,S]=i.length>0?[rt,[i,Ee]]:[Un,[Ee]],E=u.map(({database:q,spaceID:B})=>({database:q,blocks:ot(q,B,k,S)})).map(({database:q,blocks:B})=>$n(q,B)).flat();y({results:E,resultsLoading:!1}),console.debug(`got ${E.length} results for query search '${p}'`)},[c,p]),m}var F=require("@raycast/api");var ge=require("@raycast/api"),Ce=require("react/jsx-runtime");function Oe({query:c,spaceID:u}){return(0,Ce.jsx)(ge.List.Item,{title:`Create '${c}'`,detail:(0,Ce.jsx)(ge.List.Item.Detail,{markdown:`Create document '${c}'`}),actions:(0,Ce.jsx)(ge.ActionPanel,{children:(0,Ce.jsx)(ge.Action.OpenInBrowser,{url:`craftdocs://createdocument?spaceId=${u}&title=${encodeURIComponent(c)}&content=&folderId=`})})})}var ne=require("react/jsx-runtime");function Ht(c){let{isLoading:u,onSearchTextChange:p,blocks:m,query:y,config:i,searchBarAccessory:k}=c,S=i?.primarySpace()?.spaceID||"",L=i?i.getEnabledSpaces().length>1:!1;return(0,ne.jsxs)(F.List,{isLoading:u,onSearchTextChange:p,searchBarAccessory:k,children:[m.map(E=>(0,ne.jsx)(mi,{block:E,config:i,showSpaceInfo:L},`${E.spaceID}-${E.id}`)),y.length>0&&(0,ne.jsx)(F.List.Section,{title:"Create new document",children:(0,ne.jsx)(Oe,{query:y,spaceID:S})})]})}var mi=({block:c,config:u,showSpaceInfo:p})=>{let m=u?.getSpaceDisplayName(c.spaceID)||c.spaceID;return(0,ne.jsx)(F.List.Item,{icon:c.entityType==="document"?F.Icon.Document:F.Icon.Text,subtitle:c.content,title:c.documentName||c.content,accessories:p?[{tag:{value:m,color:F.Color.SecondaryText}}]:void 0,actions:(0,ne.jsx)(F.ActionPanel,{children:(0,ne.jsx)(F.Action.OpenInBrowser,{title:"Open in Craft",url:`craftdocs://open?blockId=${c.id}&spaceId=${c.spaceID}`})})})};var at=require("react"),Yn=require("@raycast/api");var Ft=require("@raycast/api"),Wn=["com.lukilabs.lukiapp","com.lukilabs.lukiapp-setapp"],Vn=()=>(0,Ft.getPreferenceValues)(),Jn=()=>(0,Ft.getPreferenceValues)();function Gt(){let[c,u]=(0,at.useState)({appExistsLoading:!0,appExists:!1});return(0,at.useEffect)(()=>{(async()=>{let m=await(0,Yn.getApplications)(),y=Vn().application,i=m.find(S=>S.bundleId&&Wn.includes(S.bundleId));if(!(y||i))return u({appExistsLoading:!1,appExists:!1});u({appExistsLoading:!1,appExists:!0})})()},[]),c}var lt=require("react");var ut=require("os"),J=require("fs"),Ne=Gn(require("path")),hi=["com.lukilabs.lukiapp","com.lukilabs.lukiapp-setapp"],[jt]=hi.map(c=>Ne.default.join((0,ut.homedir)(),`/Library/Containers/${c}/Data/Library/Application Support/${c}`)).filter(J.existsSync),di=Ne.default.join(jt,"Search"),Ut=Ne.default.join(jt,"raycast-spaces-config.json"),Ie=class{constructor(){this.spaceSettings={};this.primarySpace=()=>this.spaces.find(u=>u.primary);this.buildFilterRegexForExistingRealms=()=>{let u=jt.replace("~",(0,ut.homedir)()),p=(0,J.readdirSync)(u).filter(this.selectRealmFiles).map(this.extractSpaceIDs).filter(m=>m).join("|");return new RegExp(`(?:${p})[^.]*.sqlite$`)};this.selectRealmFiles=u=>u.match(/\.realm$/)!==null;this.extractSpaceIDs=u=>{let p=u.split("_");if(p.length===3)return p[1].split("||").pop()};this.makeSpaceFromStr=(u,p)=>{let m=p.match(/\w{8}-\w{4}-\w{4}-\w{4}-\w{12}/g)?.pop()||"",y=this.spaceSettings[m];return{primary:!p.includes("||"),path:Ne.default.join(u,p),spaceID:m,customName:y?.customName||null,isEnabled:y?.isEnabled??!0}};this.getSpaceDisplayName=u=>{let p=this.spaces.find(m=>m.spaceID===u);return p?p.customName?p.primary?`${p.customName} (Primary)`:p.customName:p.primary?`${u} (Primary)`:u:u};this.setSpaceCustomName=(u,p)=>{let m=this.spaces.find(y=>y.spaceID===u);m&&(m.customName=p),this.spaceSettings[u]||(this.spaceSettings[u]={customName:null,isEnabled:!0}),this.spaceSettings[u].customName=p,this.saveSpaceSettings()};this.toggleSpaceEnabled=u=>{let p=this.spaces.find(m=>m.spaceID===u);p&&(p.isEnabled=!p.isEnabled),this.spaceSettings[u]||(this.spaceSettings[u]={customName:null,isEnabled:!0}),this.spaceSettings[u].isEnabled=p?.isEnabled??!0,this.saveSpaceSettings()};this.getEnabledSpaces=()=>this.spaces.filter(u=>u.isEnabled);this.getAllSpacesForDropdown=()=>this.getEnabledSpaces().map(u=>({id:u.spaceID,title:this.getSpaceDisplayName(u.spaceID)}));this.loadSpaceSettings=()=>{try{if((0,J.existsSync)(Ut)){let u=(0,J.readFileSync)(Ut,"utf-8");this.spaceSettings=JSON.parse(u)}else this.spaceSettings={}}catch(u){console.debug(`Failed to load space settings: ${u}`),this.spaceSettings={}}};this.saveSpaceSettings=()=>{try{(0,J.writeFileSync)(Ut,JSON.stringify(this.spaceSettings,null,2))}catch(u){console.debug(`Failed to save space settings: ${u}`)}};try{let u=di.replace("~",(0,ut.homedir)()),p=this.buildFilterRegexForExistingRealms();this.loadSpaceSettings(),this.spaces=(0,J.readdirSync)(u).filter(m=>m.match(p)).map(m=>this.makeSpaceFromStr(u,m))}catch(u){console.debug(`failed getting files: ${u}`),this.spaces=[]}}};function $t({appExistsLoading:c,appExists:u}){let[p,m]=(0,lt.useState)({configLoading:!0,config:null}),y=()=>{if(!c){if(!u)return m(k=>({...k,configLoading:!1}));m({configLoading:!1,config:new Ie})}},i=()=>{u&&m({configLoading:!1,config:new Ie})};return(0,lt.useEffect)(()=>{y()},[c]),{...p,refreshConfig:i}}var Zn=Gn(Xn()),er=require("path"),zt=require("fs"),tr=require("@raycast/api"),mt=require("react");function Kt({config:c,configLoading:u}){let[{databases:p,databasesLoading:m},y]=(0,mt.useState)({databasesLoading:!0,databases:[]});return(0,mt.useEffect)(()=>{u||c&&Promise.all(c.spaces.map(i=>yi(i.path).then(k=>({db:k,space:i})))).then(i=>y({databases:i.map(k=>({database:k.db,spaceID:k.space.spaceID})),databasesLoading:!1})).then(()=>console.debug("initialized databases "+c.spaces.map(i=>i.spaceID).join(", ")))},[u]),{databases:p,databasesLoading:m,spaces:c?.spaces}}var yi=async c=>{let u=(0,zt.readFileSync)((0,er.join)(tr.environment.assetsPath,"sql-wasm-fts5.wasm")),p=await(0,Zn.default)({wasmBinary:u});return new p.Database((0,zt.readFileSync)(c))};var Qt={SEARCH_SPACE_ID:"searchSpaceId",DAILY_NOTES_SPACE_ID:"dailyNotesSpaceId"},nr={DEFAULT_SPACE_FILTER:"all"};var T=require("@raycast/api");var ht=require("react");function Wt({databasesLoading:c,databases:u},p){let[m,y]=(0,ht.useState)({resultsLoading:!0,results:[]});return(0,ht.useEffect)(()=>{if(c)return;y(E=>({...E,resultsLoading:!0}));let i=it(p),[k,S]=i.length>0?[rt,[i,Ee]]:[jn,[Ee]],L=u.map(({database:E,spaceID:q})=>({database:E,spaceID:q,blocks:ot(E,q,k,S)})).map(({database:E,spaceID:q,blocks:B})=>zn(E,q,B));y({resultsLoading:!1,results:L.flat()})},[c,p]),m}var W=require("@raycast/api");var re=require("react/jsx-runtime");function Vt({resultsLoading:c,results:u,setQuery:p,query:m,config:y,searchBarAccessory:i}){let k=y?y.getEnabledSpaces().length>1:!1;return(0,re.jsxs)(W.List,{isLoading:c,isShowingDetail:!0,onSearchTextChange:p,searchBarAccessory:i,children:[u.map(S=>(0,re.jsx)(W.List.Item,{title:S.block.content,accessories:k?[{tag:{value:y?.getSpaceDisplayName(S.block.spaceID)||S.block.spaceID,color:W.Color.SecondaryText}}]:void 0,detail:(0,re.jsx)(W.List.Item.Detail,{markdown:S.blocks.map(L=>L.type==="code"?"```\n"+L.content+"\n```":L.content).join(`

`)}),actions:(0,re.jsx)(W.ActionPanel,{children:(0,re.jsx)(W.Action.OpenInBrowser,{url:`craftdocs://open?blockId=${S.block.id}&spaceId=${S.block.spaceID}`})})},`${S.block.spaceID}-${S.block.id}`)),m.length>0&&(0,re.jsx)(W.List.Section,{title:"Create new document",children:(0,re.jsx)(Oe,{query:m,spaceID:y?.primarySpace()?.spaceID||""})})]})}var R=require("react/jsx-runtime"),gi=T.Toast.Style,rr=new T.Cache;function ir({value:c,spaces:u,onSpaceChange:p}){return(0,R.jsx)(T.List.Dropdown,{value:c,tooltip:"Select Space",onChange:p,children:(0,R.jsxs)(T.List.Dropdown.Section,{title:"Spaces",children:[(0,R.jsx)(T.List.Dropdown.Item,{title:"All spaces",value:"all"},"all"),u.map(m=>(0,R.jsx)(T.List.Dropdown.Item,{title:m.title,value:m.id},m.id))]})})}var{useDetailedView:bi}=Jn();function or(){let c=Gt(),u=$t(c),p=Kt(u),[m,y]=(0,Ae.useState)(""),[i,k]=(0,Ae.useState)(rr.get(Qt.SEARCH_SPACE_ID)||nr.DEFAULT_SPACE_FILTER),S=E=>{k(E),rr.set(Qt.SEARCH_SPACE_ID,E)},L={appExists:c,db:p,query:m,setQuery:y,config:u,selectedSpace:i,handleSpaceChange:S};return(0,Ae.useEffect)(()=>{c.appExistsLoading||c.appExists||(0,T.showToast)(gi.Failure,"Error","Craft app is not installed")},[c.appExistsLoading]),(0,Ae.useEffect)(()=>{i!=="all"&&u.config&&!u.config.getEnabledSpaces().find(E=>E.spaceID===i)&&S("all")},[i,u.config]),bi?_i(L):wi(L)}var wi=({appExists:c,db:u,query:p,setQuery:m,config:y,selectedSpace:i,handleSpaceChange:k})=>{let{resultsLoading:S,results:L}=Nt(u,p),E=i==="all"?L?.filter(G=>y.config?.getEnabledSpaces().some(oe=>oe.spaceID===G.spaceID)):L?.filter(G=>G.spaceID===i),q=y.config?.getAllSpacesForDropdown()||[],B=q.length>1,Y=(0,R.jsx)(Ht,{isLoading:S,onSearchTextChange:m,blocks:E,query:p,config:y.config,searchBarAccessory:B?(0,R.jsx)(ir,{spaces:q,onSpaceChange:k,value:i}):void 0}),ie=c.appExists?Y:(0,R.jsx)(sr,{});return c.appExistsLoading?Y:ie},_i=({appExists:c,db:u,query:p,setQuery:m,config:y,selectedSpace:i,handleSpaceChange:k})=>{let{resultsLoading:S,results:L}=Wt(u,p),E=i==="all"?L?.filter(G=>y.config?.getEnabledSpaces().some(oe=>oe.spaceID===G.block.spaceID)):L?.filter(G=>G.block.spaceID===i),q=y.config?.getAllSpacesForDropdown()||[],B=q.length>1,Y=(0,R.jsx)(Vt,{resultsLoading:S,setQuery:m,results:E,query:p,config:y.config,searchBarAccessory:B?(0,R.jsx)(ir,{spaces:q,onSpaceChange:k,value:i}):void 0}),ie=c.appExists?Y:(0,R.jsx)(sr,{});return c.appExistsLoading?Y:ie},sr=()=>(0,R.jsx)(R.Fragment,{children:(0,R.jsx)(T.List,{actions:(0,R.jsx)(T.ActionPanel,{children:(0,R.jsx)(T.Action,{title:"Open Extension Preferences",onAction:T.openExtensionPreferences})}),children:(0,R.jsx)(T.List.EmptyView,{title:"No results",description:"Selecting Craft application in preferences might help",icon:"command-icon-small.png"})})});
