{
  "version": 3,
  "sources": ["../src/copy-latest-download.tsx", "../src/utils.tsx", "../node_modules/untildify/index.js"],
  "sourcesContent": ["import { popToRoot, showHUD } from \"@raycast/api\";\nimport { getLatestDownload, hasAccessToDownloadsFolder as hasAccessToDownloadsFolder } from \"./utils\";\nimport { Clipboard } from \"@raycast/api\";\nimport { closeMainWindow } from \"@raycast/api\";\n\nexport default async function main() {\n  if (!hasAccessToDownloadsFolder()) {\n    await showHUD(\"No permission to access the downloads folder\");\n    return;\n  }\n\n  const download = getLatestDownload();\n  if (!download) {\n    await showHUD(\"No downloads found\");\n    return;\n  }\n\n  await Clipboard.copy({ file: download.path });\n\n  await closeMainWindow();\n  await showHUD(\"Copied latest download to clipboard\");\n  await popToRoot();\n}\n", "import { Action, ActionPanel, confirmAlert, Detail, getPreferenceValues, showToast, Toast, trash } from \"@raycast/api\";\nimport { showFailureToast } from \"@raycast/utils\";\nimport { accessSync, constants, readdirSync, statSync } from \"fs\";\nimport { rm } from \"fs/promises\";\nimport { join } from \"path\";\nimport { ComponentType } from \"react\";\nimport untildify from \"untildify\";\n\nconst preferences = getPreferenceValues();\nexport const downloadsFolder = untildify(preferences.downloadsFolder ?? \"~/Downloads\");\nconst showHiddenFiles = preferences.showHiddenFiles;\nconst fileOrder = preferences.fileOrder;\nconst lastestDownloadOrder = preferences.lastestDownloadOrder;\nexport const defaultDownloadsLayout = preferences.downloadsLayout ?? \"list\";\nconst imageExtensions = [\".png\", \".jpg\", \".jpeg\", \".gif\", \".webp\", \".bmp\", \".tiff\", \".heic\", \".svg\"];\n\nexport function isImageFile(filename: string): boolean {\n  const dotIndex = filename.lastIndexOf(\".\");\n  if (dotIndex === -1) return false;\n  const ext = filename.toLowerCase().slice(dotIndex);\n  return imageExtensions.includes(ext);\n}\n\nexport function getDownloads() {\n  const files = readdirSync(downloadsFolder);\n  return files\n    .filter((file) => showHiddenFiles || !file.startsWith(\".\"))\n    .map((file) => {\n      const path = join(downloadsFolder, file);\n      const stats = statSync(path);\n      return {\n        file,\n        path,\n        lastModifiedAt: stats.mtime,\n        createdAt: stats.ctime,\n        addedAt: stats.atime,\n        birthAt: stats.birthtime,\n      };\n    })\n    .sort((a, b) => {\n      switch (fileOrder) {\n        case \"addTime\":\n          return b.addedAt.getTime() - a.addedAt.getTime();\n        case \"createTime\":\n          return b.createdAt.getTime() - a.createdAt.getTime();\n        case \"modifiedTime\":\n        default:\n          return b.lastModifiedAt.getTime() - a.lastModifiedAt.getTime();\n      }\n    });\n}\n\nexport function getLatestDownload() {\n  const downloads = getDownloads();\n  if (downloads.length < 1) {\n    return undefined;\n  }\n\n  if (lastestDownloadOrder === \"addTime\") {\n    downloads.sort((a, b) => b.addedAt.getTime() - a.addedAt.getTime());\n  } else if (lastestDownloadOrder === \"createTime\") {\n    downloads.sort((a, b) => b.createdAt.getTime() - a.createdAt.getTime());\n  } else if (lastestDownloadOrder === \"modifiedTime\") {\n    downloads.sort((a, b) => b.lastModifiedAt.getTime() - a.lastModifiedAt.getTime());\n  } else if (lastestDownloadOrder === \"birthTime\") {\n    downloads.sort((a, b) => b.birthAt.getTime() - a.birthAt.getTime());\n  }\n\n  return downloads[0];\n}\n\nexport function hasAccessToDownloadsFolder() {\n  try {\n    accessSync(preferences.downloadsFolder, constants.R_OK);\n    return true;\n  } catch (error) {\n    console.error(error);\n    return false;\n  }\n}\n\nexport async function deleteFileOrFolder(filePath: string) {\n  if (preferences.deletionBehavior === \"trash\") {\n    try {\n      await trash(filePath);\n      await showToast({ style: Toast.Style.Success, title: \"Item Moved to Trash\" });\n    } catch (error) {\n      await showFailureToast(error, { title: \"Move to Trash Failed\" });\n    }\n    return;\n  }\n\n  const shouldDelete = await confirmAlert({\n    title: \"Delete Item?\",\n    message: `Are you sure you want to permanently delete:\\n${filePath}?`,\n    primaryAction: {\n      title: \"Delete\",\n    },\n  });\n\n  if (!shouldDelete) {\n    await showToast({ style: Toast.Style.Animated, title: \"Cancelled\" });\n    return;\n  }\n\n  try {\n    rm(filePath, { recursive: true, force: true });\n    await showToast({ style: Toast.Style.Success, title: \"Item Deleted\" });\n  } catch (error) {\n    if (error instanceof Error) {\n      await showFailureToast(error, { title: \"Deletion Failed\" });\n    }\n  }\n}\n\nexport const withAccessToDownloadsFolder = <P extends object>(Component: ComponentType<P>) => {\n  return (props: P) => {\n    if (hasAccessToDownloadsFolder()) {\n      accessSync(preferences.downloadsFolder, constants.R_OK);\n      return <Component {...props} />;\n    } else {\n      const markdown = `## Permission Required\\n\\nThe Downloads Manager extension requires access to your Downloads folder. Please grant permission to use it.\\n\\n![Grant Permission](permission.png)`;\n      return (\n        <Detail\n          markdown={markdown}\n          actions={\n            <ActionPanel>\n              <Action.Open\n                title=\"Grant Permission\"\n                target=\"x-apple.systempreferences:com.apple.preference.security?Privacy_AllFiles\"\n              />\n            </ActionPanel>\n          }\n        />\n      );\n    }\n  };\n};\n", "import os from 'node:os';\n\nlet homeDirectory;\nlet currentUser;\n\nexport default function untildify(pathWithTilde) {\n\tif (typeof pathWithTilde !== 'string') {\n\t\tthrow new TypeError(`Expected a string, got ${typeof pathWithTilde}`);\n\t}\n\n\tif (homeDirectory === undefined) {\n\t\thomeDirectory = os.homedir();\n\t}\n\n\t// Handle regular ~ expansion (current user)\n\tif (homeDirectory && /^~(?=$|\\/|\\\\)/.test(pathWithTilde)) {\n\t\treturn pathWithTilde.replace(/^~/, homeDirectory);\n\t}\n\n\t// Handle ~username expansion (only for current user)\n\tconst userMatch = pathWithTilde.match(/^~([^/\\\\]+)(.*)/);\n\tif (userMatch) {\n\t\tif (currentUser === undefined) {\n\t\t\tcurrentUser = os.userInfo().username;\n\t\t}\n\n\t\tif (currentUser) {\n\t\t\tconst username = userMatch[1];\n\t\t\tconst rest = userMatch[2];\n\t\t\tif (username === currentUser) {\n\t\t\t\treturn homeDirectory + rest;\n\t\t\t}\n\t\t}\n\t}\n\n\t// Return unchanged if no expansion occurred\n\treturn pathWithTilde;\n}\n"],
  "mappings": "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",
  "names": ["copy_latest_download_exports", "__export", "main", "__toCommonJS", "import_api", "import_api", "import_fs", "import_path", "import_node_os", "homeDirectory", "currentUser", "untildify", "pathWithTilde", "os", "userMatch", "username", "rest", "import_jsx_runtime", "preferences", "downloadsFolder", "untildify", "showHiddenFiles", "fileOrder", "lastestDownloadOrder", "defaultDownloadsLayout", "getDownloads", "downloadsFolder", "file", "showHiddenFiles", "path", "stats", "a", "b", "fileOrder", "getLatestDownload", "downloads", "lastestDownloadOrder", "hasAccessToDownloadsFolder", "preferences", "error", "import_api", "main", "hasAccessToDownloadsFolder", "download", "getLatestDownload"]
}
